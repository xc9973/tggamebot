# Implementation Plan: SicBo Button UI

## Overview

å°†éª°å®æ¸¸æˆä»å‘½ä»¤äº¤äº’æ”¹ä¸ºæŒ‰é’®äº¤äº’ï¼Œå®ç°ä¸€é”®ä¸‹æ³¨åŠŸèƒ½ã€‚

## Tasks

- [x] 1. åˆ›å»ºé”®ç›˜æ„å»ºå™¨æ¨¡å—
  - [x] 1.1 åˆ›å»º `src/sicbo_keyboard.py` æ–‡ä»¶ï¼Œå®šä¹‰ `SicBoKeyboardBuilder` ç±»
    - å®šä¹‰ `FIXED_BET_AMOUNT = 100` å¸¸é‡
    - å®šä¹‰å›è°ƒæ•°æ®å‰ç¼€ `CALLBACK_PREFIX = "sicbo_"`
    - _Requirements: 2.1_
  - [x] 1.2 å®ç° `build_main_panel()` æ–¹æ³•ï¼Œæ„å»ºä¸»ä¸‹æ³¨é¢æ¿
    - å•ä¸€æ•°å­—è¡Œï¼š[1] [2] [3] [4] [5] [6]
    - å¤§å°è¡Œï¼š[å¤§] [å°]
    - é«˜èµ”ç‡æ€»å’Œè¡Œï¼š[4(60:1)] [5(30:1)] [6(17:1)] [15(17:1)] [16(30:1)] [17(60:1)]
    - ä¸­èµ”ç‡æ€»å’Œè¡Œï¼š[7(12:1)] [8(8:1)] [13(8:1)] [14(12:1)]
    - ä½èµ”ç‡æ€»å’Œè¡Œï¼š[9(6:1)] [10(6:1)] [11(6:1)] [12(6:1)]
    - æ“ä½œè¡Œï¼š[ğŸ² å¼€éª°å­] [æˆ‘çš„æŠ¼æ³¨]
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 3.1, 4.1, 5.1, 5.2, 5.4, 7.1_
  - [x] 1.3 å®ç°å›è°ƒæ•°æ®ç¼–ç /è§£ç å‡½æ•°
    - `encode_callback(action: str, param: str = "") -> str`
    - `decode_callback(data: str) -> Tuple[str, str]`
    - _Requirements: 2.1_
  - [x] 1.4 ç¼–å†™å±æ€§æµ‹è¯•ï¼šå›è°ƒæ•°æ®è§£æå¾€è¿”
    - **Property 5: å›è°ƒæ•°æ®è§£æå¾€è¿”**
    - **Validates: Requirements 2.1, 3.1, 4.1, 5.1**

- [x] 2. å®ç°é¢æ¿æ¶ˆæ¯æ ¼å¼åŒ–
  - [x] 2.1 å®ç° `format_panel_message()` æ–¹æ³•
    - æ˜¾ç¤ºæ¸¸æˆçŠ¶æ€ã€å‰©ä½™æ—¶é—´ã€å‚ä¸äººæ•°ã€æ€»ä¸‹æ³¨é‡‘é¢
    - _Requirements: 6.1, 6.2_
  - [x] 2.2 å®ç° `format_my_bets()` æ–¹æ³•
    - æ ¼å¼åŒ–ç”¨æˆ·çš„æŠ¼æ³¨è¯¦æƒ…åˆ—è¡¨
    - _Requirements: 6.4_
  - [x] 2.3 å®ç° `format_settlement_message()` æ–¹æ³•
    - æ˜¾ç¤ºéª°å­ç»“æœã€æ¯ä¸ªç©å®¶çš„ç”¨æˆ·åå’Œèƒœè´Ÿé‡‘é¢
    - ä½¿ç”¨ ğŸ‰ å’Œ ğŸ˜¢ emoji åŒºåˆ†èƒœè´Ÿ
    - _Requirements: 7.6, 7.7_

- [x] 3. Checkpoint - ç¡®ä¿é”®ç›˜æ„å»ºå™¨æµ‹è¯•é€šè¿‡
  - è¿è¡Œæµ‹è¯•ï¼Œç¡®è®¤é”®ç›˜æ„å»ºå’Œæ¶ˆæ¯æ ¼å¼åŒ–æ­£ç¡®

- [x] 4. ä¿®æ”¹ sicbo_handler ä½¿ç”¨æŒ‰é’®é¢æ¿
  - [x] 4.1 ä¿®æ”¹ `sicbo_handler` æ–¹æ³•
    - è°ƒç”¨ `SicBoKeyboardBuilder.build_main_panel()` æ„å»ºé”®ç›˜
    - è°ƒç”¨ `format_panel_message()` æ„å»ºæ¶ˆæ¯æ–‡æœ¬
    - å‘é€å¸¦ InlineKeyboardMarkup çš„æ¶ˆæ¯
    - _Requirements: 1.1, 1.6_
  - [x] 4.2 å­˜å‚¨é¢æ¿æ¶ˆæ¯ ID ç”¨äºåç»­æ›´æ–°
    - åœ¨ SicBoGame ä¸­æ·»åŠ  `panel_message_id` å­—æ®µ
    - _Requirements: 2.5, 6.3_

- [-] 5. å®ç°æŒ‰é’®å›è°ƒå¤„ç†å™¨
  - [x] 5.1 åˆ›å»º `sicbo_callback_handler` æ–¹æ³•
    - è§£æå›è°ƒæ•°æ®ï¼Œåˆ†å‘åˆ°å¯¹åº”å¤„ç†å‡½æ•°
    - éªŒè¯æ¸¸æˆæ˜¯å¦å­˜åœ¨ä¸”åœ¨ä¸‹æ³¨é˜¶æ®µ
    - _Requirements: 8.1, 8.2_
  - [x] 5.2 å®ç°å•ä¸€æ•°å­—ä¸‹æ³¨å¤„ç†
    - è§£ææ•°å­—å‚æ•°ï¼Œè°ƒç”¨ `place_bet()` ä¸‹æ³¨
    - æ˜¾ç¤ºç¡®è®¤å¼¹çª—
    - _Requirements: 2.1, 3.2_
  - [x] 5.3 å®ç°å¤§å°ä¸‹æ³¨å¤„ç†
    - è°ƒç”¨ `place_bet()` ä¸‹æ³¨å¤§æˆ–å°
    - æ˜¾ç¤ºç¡®è®¤å¼¹çª—
    - _Requirements: 4.2, 4.3_
  - [x] 5.4 å®ç°æ€»å’Œä¸‹æ³¨å¤„ç†
    - è§£ææ€»å’Œå‚æ•°ï¼Œè°ƒç”¨ `place_bet()` ä¸‹æ³¨
    - æ˜¾ç¤ºç¡®è®¤å¼¹çª—
    - _Requirements: 5.3_
  - [x] 5.5 å®ç°ä½™é¢ä¸è¶³å¤„ç†
    - æ£€æŸ¥ä½™é¢ï¼Œä¸è¶³æ—¶æ˜¾ç¤ºé”™è¯¯å¼¹çª—ï¼Œä¸æ‰£æ¬¾
    - _Requirements: 2.3_
  - [x] 5.6 ç¼–å†™å±æ€§æµ‹è¯•ï¼šå›ºå®šä¸‹æ³¨é‡‘é¢ä¸€è‡´æ€§
    - **Property 1: å›ºå®šä¸‹æ³¨é‡‘é¢ä¸€è‡´æ€§**
    - **Validates: Requirements 2.1, 3.2, 4.2, 4.3, 5.3**
  - [x] 5.7 ç¼–å†™å±æ€§æµ‹è¯•ï¼šä½™é¢ä¸è¶³æ—¶ä¸æ‰£æ¬¾
    - **Property 2: ä½™é¢ä¸è¶³æ—¶ä¸æ‰£æ¬¾**
    - **Validates: Requirements 2.3, 8.4**

- [x] 6. å®ç°ç´¯åŠ ä¸‹æ³¨å’Œé¢æ¿æ›´æ–°
  - [x] 6.1 æ”¯æŒåŒä¸€é€‰é¡¹å¤šæ¬¡ä¸‹æ³¨ç´¯åŠ 
    - ä¿®æ”¹ `place_bet()` æˆ–åœ¨å›è°ƒå¤„ç†ä¸­ç´¯åŠ 
    - _Requirements: 2.4_
  - [x] 6.2 ä¸‹æ³¨åæ›´æ–°é¢æ¿æ¶ˆæ¯
    - è°ƒç”¨ `edit_message_text()` æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    - _Requirements: 2.5, 6.3_
  - [x] 6.3 ç¼–å†™å±æ€§æµ‹è¯•ï¼šç´¯åŠ ä¸‹æ³¨æ­£ç¡®æ€§
    - **Property 3: ç´¯åŠ ä¸‹æ³¨æ­£ç¡®æ€§**
    - **Validates: Requirements 2.4**

- [x] 7. å®ç°å¼€éª°å­å’Œæˆ‘çš„æŠ¼æ³¨æŒ‰é’®
  - [x] 7.1 å®ç° "å¼€éª°å­" æŒ‰é’®å¤„ç†
    - éªŒè¯æ¸¸æˆåœ¨ä¸‹æ³¨é˜¶æ®µ
    - è°ƒç”¨ `_do_roll_and_settle()` æ‰§è¡Œå¼€éª°å­æµç¨‹
    - _Requirements: 7.2_
  - [x] 7.2 å®ç° "æˆ‘çš„æŠ¼æ³¨" æŒ‰é’®å¤„ç†
    - è·å–ç”¨æˆ·æŠ¼æ³¨åˆ—è¡¨
    - æ˜¾ç¤ºæ ¼å¼åŒ–çš„æŠ¼æ³¨è¯¦æƒ…å¼¹çª—
    - _Requirements: 6.4_
  - [x] 7.3 ç¼–å†™å±æ€§æµ‹è¯•ï¼šæ¸¸æˆé˜¶æ®µéªŒè¯
    - **Property 4: æ¸¸æˆé˜¶æ®µéªŒè¯**
    - **Validates: Requirements 7.2, 8.1**

- [-] 8. ä¿®æ”¹ç»“ç®—æ¶ˆæ¯æ ¼å¼
  - [-] 8.1 ä¿®æ”¹ `_build_settlement_message()` ä½¿ç”¨æ–°æ ¼å¼
    - æ˜¾ç¤º @username å’Œå‡€èƒœè´Ÿé‡‘é¢
    - ä½¿ç”¨ emoji åŒºåˆ†èƒœè´Ÿ
    - _Requirements: 7.6, 7.7_

- [ ] 9. æ³¨å†Œå›è°ƒå¤„ç†å™¨
  - [ ] 9.1 åœ¨ `create_application()` ä¸­æ³¨å†Œ `CallbackQueryHandler`
    - ä½¿ç”¨ pattern è¿‡æ»¤ `sicbo_` å‰ç¼€çš„å›è°ƒ
    - _Requirements: 2.1_

- [ ] 10. Checkpoint - é›†æˆæµ‹è¯•
  - ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
  - æµ‹è¯•å®Œæ•´æ¸¸æˆæµç¨‹ï¼šå¯åŠ¨ â†’ ä¸‹æ³¨ â†’ å¼€éª°å­ â†’ ç»“ç®—

- [ ] 11. æ¸…ç†æ—§å‘½ä»¤ï¼ˆå¯é€‰ï¼‰
  - [ ] 11.1 ç§»é™¤æˆ–ä¿ç•™ `/bet` å‘½ä»¤ä½œä¸ºå¤‡ç”¨
    - å¯ä»¥ä¿ç•™å‘½ä»¤æ–¹å¼ä½œä¸ºé«˜çº§ç”¨æˆ·çš„å¤‡é€‰
    - _Requirements: N/A_

## Notes

- æ‰€æœ‰å±æ€§æµ‹è¯•ä»»åŠ¡éƒ½æ˜¯å¿…åšçš„
- ç°æœ‰çš„ `SicBoManager` å’Œ `SicBoCalculator` é€»è¾‘ä¿æŒä¸å˜
- ä¸»è¦æ”¹åŠ¨åœ¨ UI å±‚ï¼ˆé”®ç›˜æ„å»ºå’Œå›è°ƒå¤„ç†ï¼‰
